---
title: "记住这4个DevOps技巧，你的云服务将会更稳定"
date: 2019-05-15T18:41:25+08:00
draft: false
---

翻译至：[https://medium.freecodecamp.org/how-to-make-your-startups-cloud-more-stable-4-practical-devops-tips-823e4202518c](https://medium.freecodecamp.org/how-to-make-your-startups-cloud-more-stable-4-practical-devops-tips-823e4202518c)

翻译：李飞

校稿：于洋 

阅读时间：约15min

![](/img/4_dev_points/4dp_0.png)

在创业领域，当涉及到时间投入的分配问题时，这其中往往需要找到一个平衡。 我曾经遇到过很多这种情况，由于需要发布最小化可行产品(minimum viable product, MVP)时，DevOps的相关工作内容往往会占据一席之地。

我认为这是正常的，且并不是一件坏事，因为“最小化可行产品”应该是“最小化”，好的DevOps解决的大多数问题都不是小规模的问题。

但是这里有一些事情应该提前完成（或者至少要提前考虑）。 因为没有比在创业过程中发生云基础设施瘫痪从而导致业务停滞类似的事情更糟糕的了。

![](/img/4_dev_points/4dp_1.png)
### **建议 #1: 定期进行数据备份**
对于任何关心拥有持久数据的初创公司来说，这都是必须的。 您需要定期自动备份关键数据，否则您可能失去的不仅仅是文件，还会失去客户的信任，这将影响您未来的发展。

我通常在启动项目时自动执行下面两种备份方法

**数据库备份**
通常采用定时执行脚本的形式，例如每晚运行的cron作业，并像私有S3对象存储那样在云上的某处推送数据库转储。你也可以使用一些更精美的备份解决方案，但这些解决方案往往更注重为企业服务，并且会花费您大量的时间和金钱（不适合初创公司）。

![图片](/img/4_dev_points/4dp_2.png)

**磁盘快照**
当所有其他方法都失败时，如果您有磁盘副本，通常会安全。大多数主要云提供商都有适当的解决方案，可让您按照自己选择的时间周期进行磁盘快照，**因此请尽量避免编写直接连接到云服务的API的脚本**，因为你还要负责维护它们。

🚨🚨**确保测试**你的备份恢复方法或尝试类似[GitLab发生的数据丢失事件](https://about.gitlab.com/2017/02/01/gitlab-dot-com-database-incident/)，因为他们从未测试过恢复数据，因此所有5种备份方法都失败了。

### **建议＃2：设置监控并提醒关键问题👁️**
你是否知道服务器何时出现故障或应用程序因磁盘空间不足而崩溃？如果没有，你应该考虑解决这个问题（不需要太多时间）。

设置监控的最简单方法通常是直接使用云供应商的解决方案，如Amazon CloudWatch或GCP Stackdriver或阿里云监控服务。您可以设置要监控的指标，并针对云基础架构中发生的事件提供不同类型的警报，例如在磁盘运行不足时收到电子邮件、手机短信，必要时候云服务商还可以提供电话提醒服务。

如果您不想使用服务商的解决方案 - 还有与云无关的选项可以监控您的云服务。存在简单的解决方案，例如定期运行shell脚本调度发送电子邮件报告，但是更全面的解决方案为你提供系统的仪表板视图功能通常更好，更具可扩展性。企业私有云存在收费服务Blue Medora和Solar Winds等选项，但大多数创业公司需要省钱，这意味着通常会转向Countly等开源免费解决方案。

总而言之，我建议使用基于云提供商的解决方案，因为这些解决方案将保证稳定，易于设置，并且在初创公司的规模上不会花费额外的费用（译者注：很多看似免费的或者开源的服务也会引入额外的隐形成本，比如迭代成本，维护成本等）。

### **建议＃3：转向CI / CD (持续交付 / 持续继承) 工作流🚚**
![图片](/img/4_dev_points/4dp_3.png)

我在创业公司看到的一个常见的现象是发布代码的过程非常挣扎。许多人还没有把时间花在用DevOps方法构建一个稳定的发布工作流，这意味着被推送到版本控制的代码是手动测试，构建和发布的，这对开发团队来说既容易出错，也会耗费时间。

**持续集成 - 确保每次修改都不会中断**
持续集成的关键是拥有一个在每次代码准备好提交时都会能随时启动的管道。

![图片](/img/4_dev_points/4dp_4.png)
1. 代码确保提交到版本控制
2. 像Jenkins这样的自动化构建系统会创建应用程序的构建环境
3. 执行自动测试以验证系统是否仍能正常工作
4. 一旦所有测试通过，就允许将代码添加到稳定的代码库中
5. 新代码现在可以部署了（这是持续部署发挥作用的地方）

**持续部署 - 自动把你的交付版本提交到生产环境**
在持续集成管道完成验证新代码的工作后，持续部署将开始，这不会破坏你的构建。 这通常包括创建一个新的生产构建，就像在持续集成阶段所做的那样，并替换旧构建（不可变基础架构）。

从技术上讲，您可以在没有持续集成的情况下进行持续部署，但这样做的风险很大。您基本上会将未经测试的代码直接推送给客户（🚨BAD🚨）。

**在转向CI / CD时应该从哪里开始？ - 自动化测试！**
这已经不是什么秘密，**大多数开发人员不喜欢编写测试单元**（译者注：往往是开发工作流导致的，大部分开发人员在编写代码的时候会有一定的调试测试，但是由于不是TDD理念驱动，所以往往这些简单的调试测试并没有在项目层级的单元测试代码体现，所以重要的一点是如何推动TDD）。 随着应用程序的发展，它们往往需要不断更新，并且需要大量的时间，因此很多创业公司会因为“最小化可行产品(MVP)”而忽视编写测试。

**如果您没有全面的[测试套件](https://blog.wegeek.fun/post/5-minute-devops-effective-testing/)，我建议就不要考虑CI / CD，直到这个问题得到解决**。随着测试覆盖率的提高，当您看到生产中的错误越来越少时，您将开始看到主要的效率提升。 这是你能够转到CI / CD管道的其他部分的关键所在。

### **建议**＃4：容器化你的应用🚚
![图片](/img/4_dev_points/4dp_5.png)
容器技术让应用程序的自动构建变得轻松化

不要害怕容器技术，其本身很复杂，如果没有基本知识就很难理解，但利用这个技术并将应用程序转换为容器实际上是非常微不足道的。

将Dockerfile组合起来通常需要不到一个小时（取决于你的应用程序的复杂性），在你正式采用之前，你可以利用Kubernetes等优秀开源系统立即部署您的应用程序并进行管理。

通过应用容器技术，你可以立即获得一些好处。

**一致的构建**
不再有“它适用于我的机器”这样的问题 - 基于容器构建的应用，它将以相同的方式在任何机器上运行（译者注：经常会有开发者问：为什么在本地性，在测试/线上环境就不行？）。

**轻松部署**
当你部署一个开源项目，你必须经历各种手动步骤，设置数据库并安装所需的软件包吗。对于容器，现在不再是这种情况，所有这些步骤都融入到构建过程中，您只需运行一个命令即可启动服务器。

**充满活力的容器生态系统**
Docker和Kubernetes等容器平台拥有庞大且不断增长的产品和服务生态系统，可帮助您更轻松地管理应用程序。基本上消除了诸如存储，网络和资源分配等诸多问题，从而节省了时间和金钱。

### 结论
许多创业公司都没有在他们的云基础架构上投入太多时间。这通常是由于MVP要求快速发布并且之后清理技术债务的理念。

在寻求可扩展的DevOps基础架构时 - **考虑定时备份，监控，CI / CD和容器化**。这些通常很容易获胜，并将收获更稳定的云服务。
