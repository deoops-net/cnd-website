---
title: "还在用虚拟机装Linux？Docker就够了"
date: 2019-06-25T12:06:17+08:00
draft: false
---

![](https://cdn-images-1.medium.com/max/1600/1*Wy-ZVvLETOg0-__caB22HQ.png)

很多开发人员的桌面环境还都是Mac，Windows，但是我们的服务大多跑在Linux上，所以搭建一个Linux环境用来平时学习和调试就很有必要了。

往往大家在Mac或Windows环境下装Linux无非两种途径，要么双系统，要么用虚拟机。其实这两种方法都多多少少有一些弊病：

1. 双系统的安装方式对很多新手来说不够友好，比如需要分区，比如需要引导。
2. 虚拟机的方式体验又很差，很多同学为了能够有很好的体验又不得把本机的配置搞得很高，才能比较流畅的用虚拟机Linux环境。

本文来带你get一个全新技能，用Docker来构建你自己的Linux学习环境。Docker环境有许多好处：

1. **更轻量**，Docker的资源占用是极低的，你几乎感觉不到Docker占用了你什么系统资源。
2. **更便携**，当你构建好你的Linux镜像时，你可以在任何安装了Docker的主机上运行你的Linux。
3. **更酷！**想想，你在帮别的同学解决一个问题，他用的goland，这让你很不爽，你分分钟拉取了你自己的镜像，用vim秀了对方一脸。

下面我们就一起尝试一下吧。

## 准备

准备工作很简单，下载安装Docker，官方网站有无脑双击安装包，这个再简单不过了，另一个准备工作就是加大你的带宽，跑起来吧！

## 1. 基础镜像

> **Dockerfile一个配置文件，用来告诉Docker你需要构建什么样的容器镜像**

第一步我们要做的是，创建一个目录比如`my-awesome-linux`等等的项目目录，然后添加一个空文件`Dockerfile`。文件的内容如下：

![](https://cdn-images-1.medium.com/max/1600/1*YBYEI7YgxZkQwMzCEi3V7A.png)

很简单吧？只需要两行。
第一行告诉Docker我需要一个`ubuntu:16.04`版本的镜像环境。
第二行告诉Docker这个镜像的启动命令是`shell`，ok了，接下来我们一起见证奇迹！在终端中输入：

`$docker build -t my-awesome-linux .`

balabalaba……，你可以去冲几杯咖啡，取决于你的网速🙃，等镜像就构建好，你可以通过`docker images`看到你刚刚构建好的镜像。本地镜像比较多的时候可以用`grep`命令来过滤：

`$docker images | grep 'my-awesome-linux`

有了这个镜像，我们就可以在任何安装Docker的环境中运行他了，那比如我们在本地运行一下看看：

`$docker run -it my-awesome-linux bash`

你会看到你进入了一个新的shell环境，你跑一下`$ls`看看，是不是很酷！一个ubuntu环境就这么简单的出来了。

当然这还不够，上面的步骤只是一个简单的版本，要想秀同学一脸，没有定制化怎么能开心呢。接下来我们就看看如何定制化我们这个最酷的linux环境！你可以先想想脑海中那个最酷的Linux画面，各种很牛的命令行工具，各种系统调优工具，配置好的vim等等😎。

## 定制镜像

你可以接着在上面的shell环境中运行`apt-get update && apt-get install git`，这样就可以安装你需要的各种软件了，跟从零打造一个自己的linux环境没什么区别。但是我不推荐你这么做，因为在Docker容器内部新创建的文件会随着容器的销毁而销毁，所以一旦你的容器挂了，你之前的努力就白费了（至少目前是，如果你不知道`docker commit`的话）。其实就算你会用`docker commit`我也不推荐你这样做，因为我们把我们安装的每一个依赖，都完完整整的记录到Dockerfile中，能够通过git对这个镜像不断的升级优化和调整才更符合规范。

那我们就看看如何用Dockerfile来定制我们的镜像。首先我们在Dockerfile中添加两行：

![](https://cdn-images-1.medium.com/max/1600/1*-Y8gK_AxGLQmUdC2sfDA2A.png)

我们添加了两行**RUN**开头的指令，这个指令的意思是：在基础镜像环境之上**运行**这个指令。

聪明的你一定想到这两个命令用一行就可以了为什么我们要用两行呢？其实我这里也有个小心机，我故意拆成了两行：

> **Dockerfile中的所有指令都是可以缓存的，按照文件中从上至下的顺序，如果某一层（即指令）没有变动，那么`docker build`时可以利用之前的缓存。**

这样可以加快构建速度。所以笔者比较懒，就不去列举你需要通过RUN来安装的所有包了，你脑海中有利用缓存加快构建的概念就好了。

最后，还是`$docker build -t my-awesome-linux . `，冲杯咖啡，回来就构建好了，你可以接着用上面的`run`方法来测试你安装的那些软件了，很酷吧！而且当你在别的主机上运行这个镜像的时候，这些软件也都是安装好的。

到了这里你已经学会了完整构建一个属于自己的linux环境的完整路径，由于篇幅过长，我们把更多可以定制化的部分放到下一篇中。

